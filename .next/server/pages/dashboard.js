(()=>{var e={};e.id=26,e.ids=[26,888,660],e.modules={6993:(e,s,t)=>{"use strict";t.r(s),t.d(s,{config:()=>h,default:()=>m,getServerSideProps:()=>b,getStaticPaths:()=>x,getStaticProps:()=>p,reportWebVitals:()=>g,routeModule:()=>_,unstable_getServerProps:()=>N,unstable_getServerSideProps:()=>S,unstable_getStaticParams:()=>v,unstable_getStaticPaths:()=>j,unstable_getStaticProps:()=>f});var a={};t.r(a),t.d(a,{default:()=>Dashboard});var r=t(7093),i=t(5244),n=t(1323),l=t(9209),d=t.n(l),u=t(8947),c=t(997),o=t(6689);function TeamCreator({supabase:e,user:s,onCreated:t}){let[a,r]=(0,o.useState)(""),[i,n]=(0,o.useState)(!1);async function createTeam(r){r.preventDefault(),n(!0);let{data:i,error:l}=await e.from("teams").insert([{name:a,host_id:s.id}]).select().single();if(n(!1),l)return alert(l.message);t(i)}return(0,c.jsxs)("form",{onSubmit:createTeam,className:"space-y-2",children:[c.jsx("label",{className:"text-sm",children:"Team name"}),c.jsx("input",{value:a,onChange:e=>r(e.target.value),className:"w-full p-2 border rounded"}),c.jsx("div",{className:"flex justify-end",children:c.jsx("button",{className:"px-3 py-1 bg-green-600 text-white rounded",disabled:i,children:"Create Team"})})]})}function TaskCreator({supabase:e,teamId:s,onCreated:t}){let[a,r]=(0,o.useState)(""),[i,n]=(0,o.useState)(""),[l,d]=(0,o.useState)(""),[u,m]=(0,o.useState)(10);async function create(d){d.preventDefault();let{data:c,error:o}=await e.from("tasks").insert([{title:a,description:i,deadline:l||null,team_id:s,point_value:u}]).select().single();if(o)return alert(o.message);t(c),r(""),n("")}return(0,c.jsxs)("form",{onSubmit:create,className:"space-y-2",children:[c.jsx("input",{placeholder:"Title",value:a,onChange:e=>r(e.target.value),className:"w-full p-2 border rounded"}),c.jsx("textarea",{placeholder:"Description",value:i,onChange:e=>n(e.target.value),className:"w-full p-2 border rounded"}),(0,c.jsxs)("div",{className:"flex gap-2",children:[c.jsx("input",{type:"datetime-local",value:l,onChange:e=>d(e.target.value),className:"p-2 border rounded"}),c.jsx("input",{type:"number",value:u,onChange:e=>m(Number(e.target.value)),className:"p-2 border rounded w-24"})]}),c.jsx("div",{className:"flex justify-end",children:c.jsx("button",{className:"px-3 py-1 bg-indigo-600 text-white rounded",children:"Create Task"})})]})}function TasksList({supabase:e,tasks:s=[],user:t,onSubmitted:a}){let[r,i]=(0,o.useState)(null),[n,l]=(0,o.useState)(0);async function submit(s){i(s);let{data:r,error:l}=await e.from("submissions").insert([{user_id:t.id,task_id:s,score:n}]).select().single();if(i(null),l)return alert(l.message);a&&a(r)}return c.jsx("div",{className:"space-y-4",children:s.map(e=>(0,c.jsxs)("div",{className:"p-3 border rounded bg-white",children:[(0,c.jsxs)("div",{className:"flex justify-between",children:[(0,c.jsxs)("div",{children:[c.jsx("h4",{className:"font-semibold",children:e.title}),c.jsx("p",{className:"text-sm text-gray-600",children:e.description})]}),(0,c.jsxs)("div",{className:"text-right",children:[(0,c.jsxs)("div",{className:"text-sm",children:[e.point_value," pts"]}),c.jsx("div",{className:"text-xs text-gray-500",children:e.deadline?new Date(e.deadline).toLocaleString():"No deadline"})]})]}),(0,c.jsxs)("div",{className:"mt-2 flex gap-2",children:[c.jsx("input",{type:"number",value:n,onChange:e=>l(Number(e.target.value)),className:"p-1 border rounded w-24"}),c.jsx("button",{onClick:()=>submit(e.id),disabled:r===e.id,className:"px-3 py-1 bg-green-600 text-white rounded",children:"Submit"})]})]},e.id))})}function Leaderboard({supabase:e,teamId:s}){let[t,a]=(0,o.useState)([]);return(0,o.useEffect)(()=>{if(!s)return;let t=!0;async function load(){let{data:r}=await e.from("users").select("id,name,total_points").eq("team_id",s).order("total_points",{ascending:!1});t&&a(r||[])}load();let r=e.channel("public:users").on("postgres_changes",{event:"*",schema:"public",table:"users",filter:`team_id=eq.${s}`},e=>{load()}).subscribe();return()=>{t=!1,r.unsubscribe()}},[e,s]),c.jsx("div",{className:"space-y-2",children:t.map((e,s)=>(0,c.jsxs)("div",{className:"flex justify-between p-2 bg-white rounded",children:[(0,c.jsxs)("div",{children:[s+1,". ",e.name||"Anonymous"]}),(0,c.jsxs)("div",{className:"font-semibold",children:[e.total_points," pts"]})]},e.id))})}function Dashboard({supabase:e}){let[s,t]=(0,o.useState)(null),[a,r]=(0,o.useState)(null),[i,n]=(0,o.useState)([]);async function onTaskCreated(e){n(s=>[e,...s])}async function onSubmission(s){let{data:t,error:a}=await e.from("users").select("*").eq("id",s.user_id).single();!a&&t&&await e.from("users").update({total_points:(t.total_points||0)+(s.score||0)}).eq("id",t.id)}return(0,o.useEffect)(()=>{let s=e.auth.onAuthStateChange((e,s)=>{t(s?.user??null)});return(async()=>t((await e.auth.getUser()).data.user))(),()=>s.data.subscription.unsubscribe()},[e]),(0,o.useEffect)(()=>{s&&(async()=>{let{data:t}=await e.from("users").select("*").eq("id",s.id).single();r(t?.team_id??null)})()},[s,e]),(0,o.useEffect)(()=>{a&&(async()=>{let{data:s}=await e.from("tasks").select("*").eq("team_id",a).order("created_at",{ascending:!1});n(s||[])})()},[a,e]),c.jsx("main",{className:"min-h-screen bg-gray-100 p-8",children:(0,c.jsxs)("div",{className:"max-w-5xl mx-auto grid grid-cols-3 gap-6",children:[(0,c.jsxs)("section",{className:"col-span-2",children:[(0,c.jsxs)("div",{className:"bg-white p-4 rounded shadow mb-4",children:[c.jsx("h3",{className:"font-semibold",children:"Your Team"}),!a&&s&&c.jsx(TeamCreator,{supabase:e,user:s,onCreated:t=>{r(t.id),e.from("users").update({team_id:t.id}).eq("id",s.id)}}),!s&&c.jsx("div",{className:"text-sm text-gray-500",children:"Sign in to create or join a team."})]}),(0,c.jsxs)("div",{className:"bg-white p-4 rounded shadow",children:[c.jsx("h3",{className:"font-semibold",children:"Create Task"}),a?c.jsx(TaskCreator,{supabase:e,teamId:a,onCreated:onTaskCreated}):c.jsx("div",{className:"text-sm text-gray-500",children:"Create or join a team to add tasks."})]}),(0,c.jsxs)("div",{className:"mt-4",children:[c.jsx("h3",{className:"mb-2",children:"Tasks"}),c.jsx(TasksList,{supabase:e,tasks:i,user:s,onSubmitted:onSubmission})]})]}),c.jsx("aside",{children:(0,c.jsxs)("div",{className:"bg-white p-4 rounded shadow",children:[c.jsx("h3",{className:"font-semibold",children:"Leaderboard"}),c.jsx(Leaderboard,{supabase:e,teamId:a})]})})]})})}let m=(0,n.l)(a,"default"),p=(0,n.l)(a,"getStaticProps"),x=(0,n.l)(a,"getStaticPaths"),b=(0,n.l)(a,"getServerSideProps"),h=(0,n.l)(a,"config"),g=(0,n.l)(a,"reportWebVitals"),f=(0,n.l)(a,"unstable_getStaticProps"),j=(0,n.l)(a,"unstable_getStaticPaths"),v=(0,n.l)(a,"unstable_getStaticParams"),N=(0,n.l)(a,"unstable_getServerProps"),S=(0,n.l)(a,"unstable_getServerSideProps"),_=new r.PagesRouteModule({definition:{kind:i.x.PAGES,page:"/dashboard",pathname:"/dashboard",bundlePath:"",filename:""},components:{App:u.default,Document:d()},userland:a})},8947:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>App,supabase:()=>i});var a=t(997);t(6764);let r=require("@supabase/supabase-js");t(6689);let i=(0,r.createClient)(process.env.NEXT_PUBLIC_SUPABASE_URL||"",process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"");function App({Component:e,pageProps:s}){return a.jsx(e,{...s,supabase:i})}},6764:()=>{},2785:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{"use strict";e.exports=require("react")},997:e=>{"use strict";e.exports=require("react/jsx-runtime")},1017:e=>{"use strict";e.exports=require("path")}};var s=require("../webpack-runtime.js");s.C(e);var __webpack_exec__=e=>s(s.s=e),t=s.X(0,[209,450],()=>__webpack_exec__(6993));module.exports=t})();